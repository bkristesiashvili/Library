@using static Library.Common.GlobalVariables
@using static Library.Common.Enums.SystemDefaultRoles
@using Library.Services.Abstractions

@inject IUserService UserService

@{ 
    var user = await UserService.GetUserByIdAsync(Model.Id);
}

@model UserProfileEditViewModel
<div class="modal fade" id="editUser_@Model.Id" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-dark" id="exampleModalLabel">პროფილის განახლება</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <form id="profile_edit_@Model.Id" method="post" asp-controller="account" asp-action="edit" enctype="application/x-www-form-urlencoded">
                        <div class=" form-group">
                            <input asp-for="Id" value="@Model.Id" id="user_id" />
                        </div>
                        <div class="form-group">
                            <input asp-for="FirstName" value="@Model.FirstName" class="form-control text-13px" />
                            <span asp-validation-for="FirstName" class="text-danger text-11px"></span>
                        </div>
                        <div class="form-group">
                            <input asp-for="LastName" value="@Model.LastName" class="form-control text-13px" />
                            <span asp-validation-for="LastName" class="text-danger text-11px"></span>
                        </div>
                        <div class="form-group">
                            <input asp-for="Email" value="@Model.Email" class="form-control text-13px" />
                            <span asp-validation-for="Email" class="text-danger text-11px"></span>
                        </div>
                        @if (User.IsInRole(DefaultRoles[SuperAdmin]))
                        {
                            <select id="roles" asp-for="Roles" class="form-control text-13px">
                                @foreach (var role in await UserService.GetAvailableRolesAsync())
                                {
                                    if (UserService.UserIsInRole(user, role.Name))
                                    {
                                        <option class="text-13px" value="@role.Name" selected>@role.Name</option>
                                    }
                                    else
                                    {
                                        <option class="text-13px" value="@role.Name">@role.Name</option>
                                    }
                                }
                            </select>
                        }
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-sm btn-secondary text-12px" data-dismiss="modal">გაუქმება</button>
                <button type="button" onclick="updateItem('profile_edit', '@Model.Id')" class="btn btn-sm btn-success text-12px">დამახსოვრება</button>
            </div>
        </div>
    </div>
</div>